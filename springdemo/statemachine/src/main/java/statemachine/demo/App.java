/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package statemachine.demo;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.statemachine.StateMachine;
import org.springframework.statemachine.StateMachinePersist;
import org.springframework.statemachine.persist.StateMachinePersister;
import statemachine.demo.constants.Event;
import statemachine.demo.constants.State;

/**
 * 多种语法糖实现状态机的配置
 * 持久化状态机的接口
 * 事件监听
 */
@SpringBootApplication
public class App implements CommandLineRunner {

    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }

    @Autowired
    private StateMachine<State, Event> stateMachine;

    @Autowired
    private StateMachinePersister<State, Event, Integer> persister;

    @Override
    public void run(String... args) throws Exception {
        stateMachine.start();
        persister.persist(stateMachine, 1);

        stateMachine.sendEvent(Event.ACCEPT);
        persister.persist(stateMachine, 1);

        stateMachine.sendEvent(Event.THROW_EXCEPTION);
        persister.persist(stateMachine, 1);

        stateMachine.sendEvent(Event.ACCEPT);
        persister.persist(stateMachine, 1);

        stateMachine.sendEvent(Event.DONE);
        persister.persist(stateMachine, 1);
    }
}
